!function(e){var t={};function a(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(n,s,function(t){return e[t]}.bind(null,s));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([function(e,t){e.exports='<div id="referencelocatorcatastro-id" class="m-control m-container m-referencelocatorcatastro-container">\n    <div class="header">\n        \x3c!-- TITLE --\x3e\n        \x3c!--<div class="titleBusquedaCatastral">Búsqueda catastral</div>--\x3e\n        <button id="m-referencelocatorcatastro-button" class="icon-navigation-busqueda-catastral" title="Búsqueda catastral"></button>\n        <button id="m-catastrogetinfo-button" class="g-cartografia-catastrogetinfo-button" title="Consultar datos catastrales"></button>\n        <button id="m-catastroclear-button" class="g-cartografia-papelera" title="Limpiar resultados"></button>\n    </div>\n    <div class="m-tabs-referencelocatorcatastro-container">\n        <ul id="m-tabs-referencelocatorcatastro" class="group">\n            <li><a href="#" class="activated">Referencia Catastral</a></li>\n            <li><a href="#">Parámetros</a></li>\n        </ul>\n        <div id="m-tabs-referencelocatorcatastro-content">\n            \x3c!-- Parámetros de búsqueda --\x3e\n            <div id="m-searchRC-container" class="m-searchRC-tab m-tabcontent-referencelocatorcatastro show">\n                <input type="text" id="m-searchRC-input" class="g-cartografia-searchRC-input" maxlength="20" placeholder="Introduzca los 14 ó 20 dígitos de la RC"></input>\n                <div id="button-rc" class="button">\n                    <button id="m-searchRC-button" class="search" title="Buscar">\n                        <i class="g-cartografia-zoom m-search-btn"></i>Buscar\n                    </button>\n                    <button id="m-clearRC-button" class="search" title="Limpiar Resultados">\n                        <i class="g-cartografia-papelera m-search-btn"></i>Limpiar\n                    </button>\n                </div>\n            </div>\n            <div id="m-searchParams-container" class="m-searchParams-tab m-tabcontent-referencelocatorcatastro">\n                <label id="m-searchParamsProvincia-label" class="g-cartografia-searchParamsProvincia-label">Provincia:</label>\n                <select id="m-searchParamsProvincia-select" name="Provincias" class="g-cartografia-searchParamsProvincia-select">\n                    <option value="0">Seleccione una provincia</option>\n                    <option value="04">ALMERÍA</option>\n                    <option value="11">CÁDIZ</option>\n                    <option value="14">CÓRDOBA</option>\n                    <option value="18">GRANADA</option>\n                    <option value="21">HUELVA</option>\n                    <option value="23">JAÉN</option>\n                    <option value="29">MÁLAGA</option>\n                    <option value="41">SEVILLA</option>\n                </select>\n                <br>\n                <label id="m-searchParamsMunicipio-label" class="g-cartografia-searchParamsMunicipio-label">Municipio:</label>\n                <select id="m-searchParamsMunicipio-select" name="Municipios" class="g-cartografia-searchParamsMunicipio-select">\n                    <option value="0">Seleccione un municipio</option>\n                </select>\n                <br>\n                <label id="m-searchParamsPoligono-label" class="g-cartografia-searchParamsPoligono-label">Polígono:</label>\n                <input type="text" id="m-searchParamsPoligono-input" class="g-cartografia-searchParamsPoligono-input" placeholder="Introduzca un polígono">\n                <br>\n                <label id="m-searchParamsParcela-label" class="g-cartografia-searchParamsParcela-label">Parcela:</label> <input type="text" id="m-searchParamsParcela-input" class="g-cartografia-searchParamsParcela-input" placeholder="Introduzca una parcela">\n                <div id="button-params" class="button">\n                    <button id="m-searchParams-button" class="search" title="Buscar">\n                        <i class="g-cartografia-zoom m-search-btn"></i>Buscar\n                    </button>\n\n                    <button id="m-clearParams-button" class="search" title="Limpiar Resultados">\n                        <i class="g-cartografia-papelera m-search-btn"></i>Limpiar\n                    </button>\n                </div>\n            </div>\n        </div>\n        \x3c!-- Resultados de búsqueda --\x3e\n        <div id=m-referencelocatorcatastro-results>\n            \x3c!-- results searchRC --\x3e\n            <div id="m-searchRC-results" class="m-searchRC m-tabcontent-referencelocatorcatastro results-panel show">\n                <div id="m-searching-result-searchRC" class="m-searching-result g-cartografia-spinner"></div>\n            </div>\n            \x3c!-- results searchParams --\x3e\n            <div id="m-searchParams-results" class="m-searchParams m-tabcontent-referencelocatorcatastro results-panel">\n                <div id="m-searching-result-searchParams" class="m-searching-result g-cartografia-spinner"></div>\n            </div>\n        </div>\n    </div>\n</div>'},function(e,t){e.exports='<div class="catastro-results-panels">\n    {{#if partial}}\n        <div class="partial">\n            <p>No se han encontrado resultados para la búsqueda.</p>\n        </div>\n    {{/if}}\n    <div class="results" id="m-catastro-results-scroll">\n        {{#each docs}}\n            <div id="{{rcId}}" class="result">\n                {{#each attributes}}\n                    <table>\n                        <tbody>\n                            <tr>\n                                <td class="key">{{key}}</td>\n                                <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                {{/each}}\n            </div>\n        {{/each}}\n    </div>\n    {{#eq docs.length 0}}\n        <div class="results">\n            <div class="partial">No se han encontrado resultados para la búsqueda "{{query}}".</div>\n        </div>\n    {{/eq}}\n    <div class="page">\n        <span class="found" id="m-catastro-page-found">{{docs.length}}</span> de <span class="total">{{total}}</span>\n    </div>\n</div>'},function(e,t){e.exports='<div class="m-catastrogetinfo-content">\n    {{#each features}}\n        <div class="result">\n            {{#each attributes}}\n                <table>\n                    <tr>\n                        <td class="key"><b>{{key}}</b></td>\n                        <td class="value{{#oneword value}} m-wordbreak{{/oneword}}">{{{value}}}</td>\n                    </tr>\n                </table>\n            {{/each}}\n        </div>\n        <div class="m-separator"></div>\n    {{/each}}\n</div>'},function(e,t,a){},function(e,t,a){"use strict";a.r(t);a(3);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e,t,a){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,a){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(a):s.value}})(e,t,a||e)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,o(t).apply(this,arguments))}var a,n,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,M.impl.Control),a=t,(n=[{key:"addTo",value:function(e,a){i(o(t.prototype),"addTo",this).call(this,e,a)}}])&&s(a.prototype,n),c&&s(a,c),t}(),u=a(0),d=a.n(u),m=a(1),p=a.n(m),h=a(2),f=a.n(h);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(c)&&M.exception("La implementación usada no puede crear controles ReferenceLocatorCatastroControl.");var n=new c;return a=g(this,_(t).call(this,n,"ReferenceLocatorCatastro")),e?(a.options=e.options||{},a.config_=e.config||{}):M.exception("ReferenceLocatorCatastroControl: configuración no válida."),(M.utils.isUndefined(a.options.name)||M.utils.isNullOrEmpty(a.options.name))&&(a.options.name=a.NAME||"ReferenceLocatorCatastro"),a.facadeMap_=null,a.inputRC_=null,a.selectProvincias=null,a.selectMunicipios=null,a.inputPoligono=null,a.inputParcela=null,a.ConsultaMunicipioCodigos_=a.config_.CMC_url,a.DNPRC_url_=a.config_.DNPRC_url,a.CPMRC_url_=a.config_.CPMRC_url,a.DNPPP_url_=a.config_.DNPPP_url,a.RCCOOR_url_=a.config_.RCCOOR_url,a.resultsRCContainer_=null,a.resultsParamsContainer_=null,a.resultsScrollContainer_=null,a.searchingRCResult_=null,a.searchingParamsResult_=null,a.searchTime_=0,a.rcResults_=[],a.paramsResults_=[],a.scrollIsUp_=!0,a.draggablePanel=null,a.panelMinimized=!1,a.element_=null,a.SEARCHING_CLASS="m-searching",a.HIDDEN_RESULTS_CLASS="hidden",a.POPUP_TITLE="Información catastral",a.layer_=new M.layer.GeoJSON({name:"Localizador Catastral",crs:"25830"}),a}var a,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,M.Control),a=t,(n=[{key:"addEvents_",value:function(e){this.element_=e,this.resultsRCContainer_=this.element_.querySelector("div#m-searchRC-results"),this.searchingRCResult_=this.element_.querySelector("div#m-searchRC-results > div#m-searching-result-searchRC"),this.resultsParamsContainer_=this.element_.querySelector("div#m-searchParams-results"),this.searchingParamsResult_=this.element_.querySelector("div#m-searchParams-results > div#m-searching-result-searchParams")}},{key:"createView",value:function(e){var t=this;return this.facadeMap_=e,this.facadeMap_.addLayers(this.layer_),this.layer_.displayInLayerSwitcher=!1,new Promise(function(e,a){var n=M.template.compileSync(d.a);t.setStyle(n,t.options),t.element_=n,t.createCatastroPanel(),t.addEvents_(t.element_),t.togglePanel(),e(n)})}},{key:"createCatastroPanel",value:function(){var e=this,t=this.element_.querySelector("div#m-searchRC-container"),a=this.element_.querySelector("div#m-searchParams-container"),n=this.element_.querySelector("div#m-searchRC-results"),s=this.element_.querySelector("div#m-searchParams-results"),r=this.element_.querySelector("ul#m-tabs-referencelocatorcatastro > li:nth-child(1) > a"),i=this.element_.querySelector("ul#m-tabs-referencelocatorcatastro > li:nth-child(2) > a");r.addEventListener("click",function(){r.classList.contains("activated")||(r.classList.add("activated"),i.classList.remove("activated"),t.classList.add("show"),n.classList.add("show"),s.classList.remove("show"),a.classList.remove("show"))}),i.addEventListener("click",function(){i.classList.contains("activated")||(i.classList.add("activated"),r.classList.remove("activated"),t.classList.remove("show"),n.classList.remove("show"),s.classList.add("show"),a.classList.add("show"))}),this.inputRC_=this.element_.querySelector("#m-searchRC-input"),this.inputRC_.addEventListener("keyup",this.onRCSearch),this.element_.querySelector("#m-referencelocatorcatastro-button").addEventListener("click",this.activeSearch.bind(this)),this.element_.querySelector("#m-catastrogetinfo-button").addEventListener("click",this.activeInfo),this.element_.querySelector("#m-catastroclear-button").addEventListener("click",this.clearResults.bind(this)),this.selectProvincias=this.element_.querySelector("#m-searchParamsProvincia-select"),this.selectProvincias.addEventListener("change",this.onProvinciaSelect.bind(this)),this.selectMunicipios=this.element_.querySelector("#m-searchParamsMunicipio-select"),this.inputPoligono=this.element_.querySelector("#m-searchParamsPoligono-input"),this.inputParcela=this.element_.querySelector("#m-searchParamsParcela-input"),this.element_.querySelector("#m-searchRC-button").addEventListener("click",this.onRCSearch),this.element_.querySelector("#m-searchParams-button").addEventListener("click",function(t){return e.onParamsSearch(t)}),this.element_.querySelector("#m-clearRC-button").addEventListener("click",this.clearResults.bind(this)),this.element_.querySelector("#m-clearParams-button").addEventListener("click",this.clearResults.bind(this))}},{key:"setStyle",value:function(e,t){M.utils.isUndefined(t.tooltip)||M.utils.isNullOrEmpty(t.tooltip)||e.querySelector("button").setAttribute("title",t.tooltip),M.utils.isUndefined(t.icon)||M.utils.isNullOrEmpty(t.icon)||e.querySelector("button").setAttribute("class",t.icon),M.utils.isUndefined(t.order)||M.utils.isNullOrEmpty(t.order)||e.querySelector("button").parentNode.setAttribute("style","order: ".concat(t.order))}},{key:"activeSearch",value:function(){this.deactivate(),this.togglePanel()}},{key:"activeInfo",value:function(){!1===this.panelMinimized&&this.togglePanel(),this.activate()}},{key:"addClearEvents",value:function(e){this.on(M.evt.COMPLETED,function(){e.classList.add("shown")}),e.querySelector("#m-clearRC-button").addEventListener("click",this.clearResults.bind(this)),e.querySelector("#m-clearParams-button").addEventListener("click",this.clearResults.bind(this)),e.querySelector("#dialog-close-catastro").addEventListener("click",this.clearResults.bind(this))}},{key:"clearResults",value:function(){this.clearClick_()}},{key:"buildUrl_",value:function(e){var t=this,a=this.facadeMap_.getProjection().code;M.remote.get(this.RCCOOR_url_,{SRS:a,Coordenada_X:e.coord[0],Coordenada_Y:e.coord[1]}).then(function(a){t.showInfoFromURL_(a,e.coord)},{jsonp:!0})}},{key:"showInfoFromURL_",value:function(e,t){var a=this;if(200===e.code&&!1===e.error){var n=[],s=e.text,r=this.formatInfo_(s);n.push(r);var i={icon:"g-cartografia-pin",title:this.POPUP_TITLE,content:n.join("")},o=this.facadeMap_.getPopup();if(M.utils.isNullOrEmpty(o))(o=new M.Popup).addTab(i),this.facadeMap_.addPopup(o,t);else if(o.getCoordinate()[0]===t[0]&&o.getCoordinate()[1]===t[1]){var l=!1;o.getTabs().forEach(function(e){e.title!==a.POPUP_TITLE?l=!0:o.removeTab(e)}),l?o.addTab(i):((o=new M.Popup).addTab(i),this.facadeMap_.addPopup(o,t))}else(o=new M.Popup).addTab(i),this.facadeMap_.addPopup(o,t)}else this.facadeMap_.removePopup(),M.dialog.error("MAPEA: No es posible establecer la conexión con el servidor de Catastro.")}},{key:"formatInfo_",value:function(e){var t,a,n,s,r=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("consulta_coordenadas")[0];if("1"===r.getElementsByTagName("control")[0].getElementsByTagName("cuerr")[0].childNodes[0].nodeValue){a=r.getElementsByTagName("lerr")[0].getElementsByTagName("err")[0].getElementsByTagName("des")[0].childNodes[0].nodeValue}else{var i=r.getElementsByTagName("coordenadas")[0].getElementsByTagName("coord")[0],o=i.getElementsByTagName("pc")[0].getElementsByTagName("pc1")[0].childNodes[0].nodeValue,l=i.getElementsByTagName("pc2")[0].childNodes[0].nodeValue;n=o.substring(0,2),s=o.substring(2,5),t=i.getElementsByTagName("ldt")[0].childNodes[0].nodeValue,a=o+l}var c="https://www1.sedecatastro.gob.es/CYCBienInmueble/OVCConCiud.aspx?\n    del=".concat(n,"\n    &mun=").concat(s,"\n    &UrbRus=&RefC=").concat(a,"\n    &Apenom=&esBice=&RCBice1=&RCBice2=&DenoBice=");return"".concat(M.utils.beautifyAttribute("Información Catastral"),"\n    <div class='divinfo'>\n    <table class='mapea-table'>\n    <tbody>\n    <tr><td class='header' colspan='4'></td></tr>\n    <tr><td class='key'><b>").concat(M.utils.beautifyAttribute("Referencia catastral"),"</b></td><td class='value'></b>\n    <a href='").concat(c,"' target='_blank'>").concat(a,"</a></td></tr>\n    <tr><td class='key'><b>").concat(M.utils.beautifyAttribute("Descripción"),"</b></td>\n    <td class='value'>").concat(t,"</td></tr>\n    </tbody></table></div>")}},{key:"togglePanel",value:function(){var e=this.element_.querySelector(".m-tabs-referencelocatorcatastro-container");!1===this.panelMinimized?(this.panelMinimized=!0,e.style.display="none",this.element_.querySelector("#m-referencelocatorcatastro-button").classList.add("activated")):(this.panelMinimized=!1,e.style.display="inline",this.element_.querySelector("#m-referencelocatorcatastro-button").classList.add("activated"))}},{key:"onRCSearch",value:function(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){var t=this.inputRC_.value;if(M.utils.isNullOrEmpty(t))M.dialog.info("Debe introducir una referencia catastral");else{t=t.substr(0,14);var a=M.utils.addParameters(this.CPMRC_url_,{Provincia:"",Municipio:"",SRS:this.facadeMap_.getProjection().code,RC:t});this.search_(a,this.resultsRCContainer_,this.searchingRCResult_,this.showResults_)}}}},{key:"onParamsSearch",value:function(e){if(e.preventDefault(),"keyup"!==e.type||13===e.keyCode){if(M.utils.isNullOrEmpty(this.selectProvincias.value)||"0"===this.selectProvincias.value)return void M.dialog.info("Debe seleccionar una provincia.");if(M.utils.isNullOrEmpty(this.selectMunicipios.value)||"0"===this.selectMunicipios.value)return void M.dialog.info("Debe seleccionar un municpio.");if(M.utils.isNullOrEmpty(this.inputPoligono.value))return void M.dialog.info("Debe introducir un polígono.");if(M.utils.isNullOrEmpty(this.inputParcela.value))return void M.dialog.info("Debe introducir una parcela.");var t=M.utils.addParameters(this.DNPPP_url_,{CodigoProvincia:this.selectProvincias.value,CodigoMunicipio:this.selectMunicipios.value,CodigoMunicipioINE:"",Poligono:this.inputPoligono.value,Parcela:this.inputParcela.value});this.search_(t,this.resultsParamsContainer_,this.searchingParamsResult_,this.showResults_)}}},{key:"search_",value:function(e,t,a,n){var s=this;t.appendChild(a),this.element_.classList.add(this.SEARCHING_CLASS),M.remote.get(e).then(function(e){s.acceptOVCSW(e)&&n.call(s,e.xml,t),s.element_.classList.remove(s.SEARCHING_CLASS)})}},{key:"acceptOVCSW",value:function(e){var t=!0;try{if(200===e.code&&!1===e.error){var a=e.xml.childNodes[0],n=a.getElementsByTagName("control")[0].getElementsByTagName("cuerr")[0],s="0";if(void 0!==n&&(s=n.childNodes[0].nodeValue),"1"===s){var r=a.getElementsByTagName("lerr")[0].getElementsByTagName("err")[0].getElementsByTagName("des")[0].childNodes[0].nodeValue;this.element_.classList.remove(this.SEARCHING_CLASS),t=!1,M.dialog.info(r)}}else t=!1,M.dialog.error("MAPEA: No es posible establecer la conexión con el servidor de Catastro.")}catch(e){t=!1,M.exception("La respuesta no es un JSON válido: ".concat(e,"."))}return t}},{key:"parseCPMRCResults",value:function(e){var t=e.getElementsByTagName("consulta_coordenadas")[0].getElementsByTagName("coordenadas")[0].getElementsByTagName("coord")[0],a=t.getElementsByTagName("pc")[0],n=a.getElementsByTagName("pc1")[0].childNodes[0].nodeValue,s=a.getElementsByTagName("pc2")[0].childNodes[0].nodeValue,r=t.getElementsByTagName("geo")[0],i=r.getElementsByTagName("xcen")[0].childNodes[0].nodeValue,o=r.getElementsByTagName("ycen")[0].childNodes[0].nodeValue,l=r.getElementsByTagName("srs")[0].childNodes[0].nodeValue;return{attributes:[{key:"Referencia Catastral",value:n+s},{key:"Descripción",value:t.getElementsByTagName("ldt")[0].childNodes[0].nodeValue}],rcId:"rc_".concat(n).concat(s),coords:[{xcen:i,ycen:o,srs:l}]}}},{key:"showResults_",value:function(e,t){var a=this;this.getLayer().clear();var n={};t===this.resultsRCContainer_?n=this.parseRCResultsForTemplate_(e,!1):t===this.resultsParamsContainer_&&(n=this.parseParamsResultsForTemplate_(e,!1)),Promise.resolve(n).then(function(e){a.drawResults(e);var n=M.template.compileSync(p.a,{vars:e});t.classList.remove(a.HIDDEN_RESULTS_CLASS);for(var s=t.querySelectorAll(".result"),r=0,i=s.length;r<i;r+=1)s.item(r).removeEventListener("click",a.resultClick_);a.zoomToResults();var o=t.querySelector("div.page > div.g-cartografia-flecha-arriba");M.utils.isNullOrEmpty(o)||o.removeEventListener("click",a.resultsClick_),t.innerHTML=n.innerHTML,a.resultsScrollContainer_=t.querySelector("div#m-catastro-results-scroll"),a.resultsScrollContainer_.scrollIntoView(!1);for(var l=0,c=(s=t.getElementsByClassName("result")).length;l<c;l+=1)s.item(l).addEventListener("click",a.resultClick_);a.fire(M.evt.COMPLETED)})}},{key:"parseRCResultsForTemplate_",value:function(e,t){var a=this.parseCPMRCResults(e);return!0===t?this.rcResults_.unshift(a):this.rcResults_=[a],{docs:this.rcResults_,total:this.rcResults_.length,partial:!1,notResutls:!1,query:this.inputRC_.value}}},{key:"parseParamsResultsForTemplate_",value:function(e,t){var a,n=this,s=e.getElementsByTagName("consulta_dnp")[0],r="N/A",i="UR",o=s.getElementsByTagName("lrcdnp");if(o.length>0){var l=o[0].getElementsByTagName("rcdnp")[0];a=l.getElementsByTagName("rc")[0];var c=l.getElementsByTagName("dt")[0],u=c.getElementsByTagName("np")[0].childNodes[0].nodeValue,d=c.getElementsByTagName("nm")[0].childNodes[0].nodeValue,m=c.getElementsByTagName("locs")[0].getElementsByTagName("lors")[0].getElementsByTagName("lorus")[0],p=m.getElementsByTagName("npa")[0].childNodes[0].nodeValue,h=m.getElementsByTagName("cpaj")[0].childNodes[0].nodeValue;r="".concat(p," ").concat(h,". ").concat(d," (").concat(u,")")}else{var f=s.getElementsByTagName("bico")[0].getElementsByTagName("bi")[0],v=f.getElementsByTagName("idbi")[0];i=v.getElementsByTagName("cn")[0].childNodes[0].nodeValue,a=v.getElementsByTagName("rc")[0],r=f.getElementsByTagName("ldt")[0].childNodes[0].nodeValue}var y=a.getElementsByTagName("pc1")[0].childNodes[0].nodeValue,g=a.getElementsByTagName("pc2")[0].childNodes[0].nodeValue,_=this.selectProvincias.value+this.selectMunicipios.value+this.inputPoligono.value+this.inputParcela.value,b=M.utils.addParameters(this.CPMRC_url_,{Provincia:"",Municipio:"",SRS:this.facadeMap_.getProjection().code,RC:y+g});return M.remote.get(b).then(function(e){if(n.acceptOVCSW(e)){var a=n.parseCPMRCResults(e.xml),s=a.coords[0].xcen,o=a.coords[0].ycen,l=a.coords[0].srs,c={attributes:[{key:"Referencia Catastral",value:y+g},{key:"Descripción",value:r},{key:"Tipo",value:i}],paramsId:_,rcId:"rc_".concat(y).concat(g),coords:[{xcen:s,ycen:o,srs:l}]};return!0===t?n.paramsResults_.unshift(c):n.paramsResults_=[c],{docs:n.paramsResults_,total:n.paramsResults_.length,partial:!1,notResutls:!1,query:y+g}}return"Unsuccessful response."})}},{key:"resultClick_",value:function(e){e.preventDefault(),M.window.WIDTH,M.config.MOBILE_WIDTH,this.facadeMap_.removePopup();var t=e.currentTarget.id;this.resultClick(t)}},{key:"clearClick_",value:function(){this.element_.classList.remove("shown"),M.utils.isNullOrEmpty(this.inputRC_)||(this.inputRC_.value=""),M.utils.isNullOrEmpty(this.selectProvincias)||(this.selectProvincias.value="0"),M.utils.isNullOrEmpty(this.selectMunicipios)||(this.selectMunicipios.value="0"),M.utils.isNullOrEmpty(this.inputPoligono)||(this.inputPoligono.value=""),M.utils.isNullOrEmpty(this.inputParcela)||(this.inputParcela.value=""),M.utils.isNullOrEmpty(this.resultsRCContainer_)||(this.resultsRCContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsParamsContainer_)||(this.resultsParamsContainer_.innerHTML=""),M.utils.isNullOrEmpty(this.resultsScrollContainer_)||(this.resultsScrollContainer_.innerHTML="",this.resultsScrollContainer_=null),M.utils.isNullOrEmpty(this.rcResults_)?this.rcResults_=[]:this.rcResults_.length=0,M.utils.isNullOrEmpty(this.paramsResults_)?this.paramsResults_=[]:this.paramsResults_.length=0,this.resultsRCContainer_.classList.remove(this.HIDDEN_RESULTS_CLASS),this.resultsParamsContainer_.classList.remove(this.HIDDEN_RESULTS_CLASS),this.clear()}},{key:"resultsClick_",value:function(e){this.facadeMap_.areasContainer.getElementsByClassName("m-top m-right")[0].classList.add("top-extra-search"),e.target.classlist.toggle("g-cartografia-flecha-arriba"),e.target.classlist.toggle("g-cartografia-flecha-abajo"),this.resultsRCContainer_.classlist.toggle(this.HIDDEN_RESULTS_CLASS),this.resultsParamsContainer_.classlist.toggle(this.HIDDEN_RESULTS_CLASS)}},{key:"onProvinciaSelect",value:function(e){var t=this,a=e.target.value;"0"!==a?M.remote.get(this.ConsultaMunicipioCodigos_,{CodigoProvincia:a,CodigoMunicipio:"",CodigoMunicipioIne:""}).then(function(e){t.loadMunicipiosSelect(e)}):this.clearMunicipiosSelect()}},{key:"clearMunicipiosSelect",value:function(){for(var e=this.element_.getElementsByTagName("select")["m-searchParamsMunicipio-select"];e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("option");t.value="0",t.innerHTML="Seleccione un municipio",e.appendChild(t)}},{key:"loadMunicipiosSelect",value:function(e){if(200===e.code&&!1===e.error){var t=e.xml.getElementsByTagName("consulta_municipiero")[0].getElementsByTagName("municipiero")[0].getElementsByTagName("muni"),a=this.element_.getElementsByTagName("select")["m-searchParamsMunicipio-select"];this.clearMunicipiosSelect();for(var n=0;n<t.length;n+=1){var s=document.createElement("option"),r=t[n].getElementsByTagName("locat")[0];s.value=r.getElementsByTagName("cmc")[0].childNodes[0].nodeValue,s.innerHTML=t[n].getElementsByTagName("nm")[0].childNodes[0].nodeValue,a.appendChild(s)}}else M.dialog.error("MAPEA: No es posible establecer la conexión con el servidor de Catastro.")}},{key:"drawResults",value:function(e){var t=[];M.utils.isNullOrEmpty(t)&&(t=e.docs);var a=t.map(function(e){var t=e.coords[0].xcen,a=e.coords[0].ycen,n={};return e.attributes.forEach(function(e){n[e.key]=e.value}),new M.Feature(e.rcId,{type:"Feature",geometry:{type:"Point",coordinates:[t,a]},properties:n})},this);this.layer_.addFeatures(a)}},{key:"zoomToResults",value:function(){var e=this.layer_.getFeaturesExtent();this.facadeMap_.removePopup(),this.facadeMap_.setBbox(e)}},{key:"getLayer",value:function(){return this.layer_}},{key:"resultClick",value:function(e){var t=this.layer_.getFeatureById(e);this.selectedFeatures_=[t];var a=t.getGeometry().coordinates;this.unselectResults(),this.selectFeatures([t],a,!0),this.facadeMap_.setCenter(a),this.facadeMap_.setZoom(15)}},{key:"clear",value:function(){this.facadeMap_.removePopup(),this.layer_.clear()}},{key:"selectFeatures",value:function(e,t,a){var n=this;this.unselectResults(),this.selectedFeatures_=e;var s=this.parseFeaturesForTemplate_(e),r=M.template.compileSync(f.a,{jsonp:!1,vars:s,parseToHtml:!1}),i={icon:"g-cartografia-pin",title:this.POPUP_TITLE,content:r},o=this.facadeMap_.getPopup();M.utils.isNullOrEmpty(o)?((o=new M.Popup({panMapIfOutOfView:!a,ani:null})).addTab(i),this.facadeMap_.addPopup(o,t)):o.addTab(i),o.on(M.evt.DESTROY,function(){n.unselectResults(!0)},this)}},{key:"parseFeaturesForTemplate_",value:function(e){var t={features:[]};return e.forEach(function(e){var a=[],n=e.getAttributes();n.forEach(function(e,t){a.push({key:t,value:n[t]})});var s={attributes:a};t.features.push(s)}),t}},{key:"unselectResults",value:function(e){this.selectedFeatures_.length>0&&(this.selectedFeatures_.length=0,e||this.facadeMap_.removePopup())}},{key:"activate",value:function(){var e=this;if(this.activated)this.deactivate();else{var t=!1;this.facadeMap_.getControls().some(function(a){return!0!==a.activated||a instanceof e||(M.dialog.info("Desactive el control ".concat(a.name," antes de activar este.")),t=!0),t}),!1===t?(this.facadeMap_.on(M.evt.CLICK,this.buildUrl_,this),this.activated=!0,this.element_.querySelector("#m-catastrogetinfo-button").classList.add("activated")):this.activated=!1}}},{key:"deactivate",value:function(){this.facadeMap_.removePopup(),this.facadeMap_.un(M.evt.CLICK,this.buildUrl_,this),this.activated=!1,this.element_.querySelector("#m-catastrogetinfo-button").classList.remove("activated")}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-referencelocatorcatastro button")}},{key:"equals",value:function(e){return e instanceof t}},{key:"destroy",value:function(){this.clear(),this.facadeMap_.areasContainer.querySelector(".m-top.m-right").classList.remove("top-extra"),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.layer_=null}}])&&y(a.prototype,n),s&&y(a,s),t}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isNullOrEmpty(e)&&M.exception("No ha especificado ningún parámetro."),(a=R(this,S(t).call(this))).config_=e.config||{},a.map_=null,a.controls_=[],a.catastroLayer_=null,a.position=e.position||"TL",a}var a,n,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,M.Plugin),a=t,(n=[{key:"addTo",value:function(e){this.controls_.push(new P(this.config_)),this.map_=e,e.areasContainer.querySelector(".m-top.m-right").classList.add("top-extra"),this.panel_=new M.ui.Panel("panelReferenceLocatorCatastro",{className:"m-catastro",collapsedButtonClass:"g-catastropanel-button-closed",collapsible:!0,position:M.ui.position[this.position],tooltip:"Búsqueda catastral"}),this.panel_.on(M.evt.ADDED_TO_MAP,function(e){M.utils.enableTouchScroll(e)}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_),this.config_.config.catastroWMS&&(this.catastroLayer_=new M.layer.WMS({url:this.config_.config.catastroWMS.wms_url,name:this.config_.config.catastroWMS.name,legend:"Catastro",transparent:!0,tiled:!1}),this.map_.addWMS(this.catastroLayer_));var t=this;this.controls_[0].on(M.evt.ADDED_TO_MAP,function(){t.fire(M.evt.ADDED_TO_MAP)})}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.controls_=null}},{key:"getControls",value:function(){return this.controls_}},{key:"getResultsLayer",value:function(){return this.controls_[0].getLayer()}},{key:"getWMSCatastroLayer",value:function(){return this.catastroLayer_}}])&&E(a.prototype,n),s&&E(a,s),t}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.ReferenceLocatorCatastro=T,window.M.control.ReferenceLocatorCatastroControl=P,window.M.impl.control.ReferenceLocatorCatastroControl=c}]);
//# sourceMappingURL=referencelocatorcatastro.ol.min.js.map